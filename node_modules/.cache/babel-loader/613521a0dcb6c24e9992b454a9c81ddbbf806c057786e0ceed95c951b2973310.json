{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode, unref as _unref, createVNode as _createVNode, vShow as _vShow, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-4fc2aa12\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"media\"\n};\nconst _hoisted_2 = {\n  class: \"media-img-wrapper\"\n};\nconst _hoisted_3 = [\"src\", \"alt\"];\nconst _hoisted_4 = {\n  class: \"media-body\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"text-muted original-price\"\n};\nconst _hoisted_6 = {\n  class: \"price\"\n};\nimport useProductList from \"@/stores/useProductList\";\nimport useCart from \"@/stores/useCart\";\nimport { onMounted, reactive, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\nimport { ShoppingCart } from '@element-plus/icons-vue';\nexport default {\n  __name: 'ProductDetail',\n  setup(__props) {\n    const currentTypeId = ref(\"e84893a3-cad7-4ef3-8f7d-58e090c7f128\"); //默认当前类型的套餐\n\n    const ProductList = useProductList();\n    const route = useRoute();\n    const product = ref({});\n    const productTypes = ref([]);\n    const Cart = useCart();\n    onMounted(async () => {\n      if (ProductList.Products.length === 0) {\n        await ProductList.getAllProduct();\n      }\n      await ProductList.getProductTypeByProductId(route.params.id);\n      product.value = ProductList.GetProdcutById(route.params.id);\n      productTypes.value = ProductList.ProductTypes;\n      if (product.value.variants.length > 0) {\n        var prices = product.value.variants.map(variant => variant.price);\n        var minPrice = Math.min(...prices);\n        currentTypeId.value = product.value.variants.find(x => x.price === minPrice).productTypeId;\n      }\n    });\n    function GetSelectedProdcutVariant() {\n      if (product.value.variants != undefined) {\n        var variant = product.value.variants.find(v => v.productTypeId == currentTypeId.value);\n        return variant;\n      }\n    }\n    async function AddToCart() {\n      var variant = GetSelectedProdcutVariant();\n      var cartItem = reactive({\n        productId: variant.productId,\n        productTypeId: variant.productTypeId,\n        quantity: 1\n      });\n      await Cart.AddToCart(cartItem);\n    }\n    return (_ctx, _cache) => {\n      const _component_el_radio = _resolveComponent(\"el-radio\");\n      const _component_el_radio_group = _resolveComponent(\"el-radio-group\");\n      const _component_el_button = _resolveComponent(\"el-button\");\n      return _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"img\", {\n        class: \"media-img\",\n        src: product.value.imageUrl,\n        alt: product.value.title\n      }, null, 8, _hoisted_3)]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h2\", null, _toDisplayString(product.value.title), 1), _createElementVNode(\"p\", null, _toDisplayString(product.value.description), 1), product.value.variants != null && product.value.variants.length > 1 ? (_openBlock(), _createBlock(_component_el_radio_group, {\n        key: 0,\n        modelValue: currentTypeId.value,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => currentTypeId.value = $event),\n        class: \"ml-4\"\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(productTypes.value, productType => {\n          return _openBlock(), _createBlock(_component_el_radio, {\n            key: productType.id,\n            label: productType.id\n          }, {\n            default: _withCtx(() => [_createTextVNode(_toDisplayString(productType.name), 1)]),\n            _: 2\n          }, 1032, [\"label\"]);\n        }), 128))]),\n        _: 1\n      }, 8, [\"modelValue\"])) : _createCommentVNode(\"\", true), GetSelectedProdcutVariant() != null ? (_openBlock(), _createElementBlock(_Fragment, {\n        key: 1\n      }, [GetSelectedProdcutVariant().originalPrice > GetSelectedProdcutVariant().price ? (_openBlock(), _createElementBlock(\"h6\", _hoisted_5, \" 原价：￥\" + _toDisplayString(GetSelectedProdcutVariant().originalPrice), 1)) : _createCommentVNode(\"\", true), _createElementVNode(\"h4\", _hoisted_6, \" 到手价：￥\" + _toDisplayString(GetSelectedProdcutVariant().price), 1)], 64)) : _createCommentVNode(\"\", true), _createVNode(_component_el_button, {\n        color: \"#626aef\",\n        icon: _unref(ShoppingCart),\n        onClick: AddToCart\n      }, {\n        default: _withCtx(() => [_createTextVNode(\"加入购物车\")]),\n        _: 1\n      }, 8, [\"icon\"])])], 512)), [[_vShow, product.value != null]]);\n    };\n  }\n};","map":{"version":3,"names":["useProductList","useCart","onMounted","reactive","ref","useRoute","ShoppingCart","currentTypeId","ProductList","route","product","productTypes","Cart","Products","length","getAllProduct","getProductTypeByProductId","params","id","value","GetProdcutById","ProductTypes","variants","prices","map","variant","price","minPrice","Math","min","find","x","productTypeId","GetSelectedProdcutVariant","undefined","v","AddToCart","cartItem","productId","quantity"],"sources":["D:/PersonalFile/WebStudy/myShop-vue/myshop-vue/src/pages/ProductDetail/ProductDetail.vue"],"sourcesContent":["<template>\r\n    <div class=\"media\" v-show=\"product != null\">\r\n        <div class=\"media-img-wrapper\">\r\n            <img class=\"media-img\" :src=\"product.imageUrl\" :alt=\"product.title\" />\r\n        </div>\r\n\r\n        <div class=\"media-body\">\r\n            <h2>{{ product.title }}</h2>\r\n            <p>{{ product.description }}</p>\r\n\r\n            <template v-if=\"product.variants != null && product.variants.length > 1\">\r\n                <el-radio-group v-model=\"currentTypeId\" class=\"ml-4\">\r\n                    <el-radio v-for=\"productType in productTypes\" :key=\"productType.id\" :label=\"productType.id\">\r\n                        {{ productType.name }}\r\n                    </el-radio>\r\n                </el-radio-group>\r\n            </template>\r\n\r\n            <template v-if=\"GetSelectedProdcutVariant() != null\">\r\n                <template v-if=\"GetSelectedProdcutVariant().originalPrice > GetSelectedProdcutVariant().price\">\r\n                    <h6 class=\"text-muted original-price\">\r\n                        原价：￥{{ GetSelectedProdcutVariant().originalPrice }}\r\n                    </h6>\r\n                </template>\r\n\r\n                <h4 class=\"price\">\r\n                    到手价：￥{{ GetSelectedProdcutVariant().price }}\r\n                </h4>\r\n            </template>\r\n\r\n            <el-button color=\"#626aef\" :icon=\"ShoppingCart\" @click=\"AddToCart\">加入购物车</el-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport useProductList from \"@/stores/useProductList\";\r\nimport useCart from \"@/stores/useCart\";\r\nimport { onMounted, reactive, ref } from \"vue\";\r\nimport { useRoute } from \"vue-router\";\r\nimport { ShoppingCart } from '@element-plus/icons-vue'\r\n\r\nconst currentTypeId = ref(\"e84893a3-cad7-4ef3-8f7d-58e090c7f128\");  //默认当前类型的套餐\r\n\r\nconst ProductList = useProductList();\r\nconst route = useRoute();\r\nconst product = ref({})\r\nconst productTypes = ref([])\r\n\r\nconst Cart = useCart();\r\n\r\nonMounted(async () => {\r\n    if (ProductList.Products.length === 0) {\r\n        await ProductList.getAllProduct();\r\n    }\r\n    await ProductList.getProductTypeByProductId(route.params.id);\r\n\r\n    product.value = ProductList.GetProdcutById(route.params.id);\r\n    productTypes.value = ProductList.ProductTypes\r\n\r\n    if (product.value.variants.length > 0) {\r\n        var prices = product.value.variants.map(variant => variant.price);\r\n        var minPrice = Math.min(...prices);\r\n\r\n        currentTypeId.value = product.value.variants.find(x => x.price === minPrice).productTypeId;\r\n    }\r\n});\r\n\r\nfunction GetSelectedProdcutVariant() {\r\n    if (product.value.variants != undefined) {\r\n        var variant = product.value.variants.find(v => v.productTypeId == currentTypeId.value)\r\n        return variant;\r\n    }\r\n}\r\n\r\nasync function AddToCart() {\r\n    var variant = GetSelectedProdcutVariant();\r\n    var cartItem = reactive({\r\n        productId: variant.productId,\r\n        productTypeId: variant.productTypeId,\r\n        quantity: 1\r\n    })\r\n\r\n    await Cart.AddToCart(cartItem);\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.media {\r\n    display: flex;\r\n}\r\n\r\n.media-img {\r\n    max-height: 500px;\r\n    max-width: 500px;\r\n    border-radius: 6px;\r\n    margin: 0 10px 10px 10px;\r\n}\r\n\r\n.media-img-wrapper {\r\n    max-width: 500px;\r\n    max-height: 500px;\r\n    text-align: center;\r\n    flex: 1;\r\n}\r\n\r\n.media-body {\r\n    flex: 1;\r\n}\r\n\r\n.original-price {\r\n    text-decoration: line-through;\r\n}\r\n\r\n.price {\r\n    color: green;\r\n}\r\n</style>"],"mappings":";;;;;;;;;;;;;;;;;;;AAoCA,OAAOA,cAAc,MAAM,yBAAyB;AACpD,OAAOC,OAAO,MAAM,kBAAkB;AACtC,SAASC,SAAS,EAAEC,QAAQ,EAAEC,GAAG,QAAQ,KAAK;AAC9C,SAASC,QAAQ,QAAQ,YAAY;AACrC,SAASC,YAAY,QAAQ,yBAAyB;;;;IAEtD,MAAMC,aAAa,GAAGH,GAAG,CAAC,sCAAsC,CAAC,CAAC,CAAE;;IAEpE,MAAMI,WAAW,GAAGR,cAAc,CAAC,CAAC;IACpC,MAAMS,KAAK,GAAGJ,QAAQ,CAAC,CAAC;IACxB,MAAMK,OAAO,GAAGN,GAAG,CAAC,CAAC,CAAC,CAAC;IACvB,MAAMO,YAAY,GAAGP,GAAG,CAAC,EAAE,CAAC;IAE5B,MAAMQ,IAAI,GAAGX,OAAO,CAAC,CAAC;IAEtBC,SAAS,CAAC,YAAY;MAClB,IAAIM,WAAW,CAACK,QAAQ,CAACC,MAAM,KAAK,CAAC,EAAE;QACnC,MAAMN,WAAW,CAACO,aAAa,CAAC,CAAC;MACrC;MACA,MAAMP,WAAW,CAACQ,yBAAyB,CAACP,KAAK,CAACQ,MAAM,CAACC,EAAE,CAAC;MAE5DR,OAAO,CAACS,KAAK,GAAGX,WAAW,CAACY,cAAc,CAACX,KAAK,CAACQ,MAAM,CAACC,EAAE,CAAC;MAC3DP,YAAY,CAACQ,KAAK,GAAGX,WAAW,CAACa,YAAY;MAE7C,IAAIX,OAAO,CAACS,KAAK,CAACG,QAAQ,CAACR,MAAM,GAAG,CAAC,EAAE;QACnC,IAAIS,MAAM,GAAGb,OAAO,CAACS,KAAK,CAACG,QAAQ,CAACE,GAAG,CAACC,OAAO,IAAIA,OAAO,CAACC,KAAK,CAAC;QACjE,IAAIC,QAAQ,GAAGC,IAAI,CAACC,GAAG,CAAC,GAAGN,MAAM,CAAC;QAElChB,aAAa,CAACY,KAAK,GAAGT,OAAO,CAACS,KAAK,CAACG,QAAQ,CAACQ,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACL,KAAK,KAAKC,QAAQ,CAAC,CAACK,aAAa;MAC9F;IACJ,CAAC,CAAC;IAEF,SAASC,yBAAyBA,CAAA,EAAG;MACjC,IAAIvB,OAAO,CAACS,KAAK,CAACG,QAAQ,IAAIY,SAAS,EAAE;QACrC,IAAIT,OAAO,GAAGf,OAAO,CAACS,KAAK,CAACG,QAAQ,CAACQ,IAAI,CAACK,CAAC,IAAIA,CAAC,CAACH,aAAa,IAAIzB,aAAa,CAACY,KAAK,CAAC;QACtF,OAAOM,OAAO;MAClB;IACJ;IAEA,eAAeW,SAASA,CAAA,EAAG;MACvB,IAAIX,OAAO,GAAGQ,yBAAyB,CAAC,CAAC;MACzC,IAAII,QAAQ,GAAGlC,QAAQ,CAAC;QACpBmC,SAAS,EAAEb,OAAO,CAACa,SAAS;QAC5BN,aAAa,EAAEP,OAAO,CAACO,aAAa;QACpCO,QAAQ,EAAE;MACd,CAAC,CAAC;MAEF,MAAM3B,IAAI,CAACwB,SAAS,CAACC,QAAQ,CAAC;IAClC"},"metadata":{},"sourceType":"module","externalDependencies":[]}