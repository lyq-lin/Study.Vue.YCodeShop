{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport useUser from '@/stores/useUser';\nimport { ref, reactive, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport jwt_decode from \"jwt-decode\";\nimport useAuthenticationState from '@/hook/auth/useAuthenticationState';\nexport default {\n  __name: 'Login',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const isPwdOrCode = ref(true);\n    const User = useUser();\n    const router = useRouter();\n    const loginModel = reactive({\n      phoneNumer: \"\",\n      password: \"\",\n      code: \"\"\n    });\n    onMounted(async () => {\n      const isAuth = ref(useAuthenticationState());\n      if (isAuth.value.state) {\n        router.push({\n          path: '/product/feature'\n        });\n      }\n    });\n    function ToCodeLogin() {\n      isPwdOrCode.value = !isPwdOrCode.value;\n    }\n    async function getCode(phone) {\n      await User.getCode(phone);\n    }\n    async function login() {\n      const result = ref(false);\n      if (isPwdOrCode.value) {\n        result.value = await User.loginByPassword(loginModel.phoneNumer, loginModel.password);\n      } else {\n        result.value = await User.loginByCode(loginModel.phoneNumer, loginModel.code);\n      }\n      if (result.value === true) {\n        const jwtPayload = localStorage.getItem(\"authToken\");\n        const decodeJwt = jwt_decode(jwtPayload);\n        User.user.userId = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"];\n        User.user.userName = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"];\n        User.user.userRole = decodeJwt[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"];\n        User.user.jwtVersion = decodeJwt[\"JwtVersion\"];\n        User.user.exp = decodeJwt[\"exp\"];\n        router.push({\n          path: '/product/feature'\n        });\n      }\n    }\n    const __returned__ = {\n      isPwdOrCode,\n      User,\n      router,\n      loginModel,\n      ToCodeLogin,\n      getCode,\n      login,\n      get useUser() {\n        return useUser;\n      },\n      ref,\n      reactive,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get jwt_decode() {\n        return jwt_decode;\n      },\n      get useAuthenticationState() {\n        return useAuthenticationState;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["useUser","ref","reactive","onMounted","useRouter","jwt_decode","useAuthenticationState","isPwdOrCode","User","router","loginModel","phoneNumer","password","code","isAuth","value","state","push","path","ToCodeLogin","getCode","phone","login","result","loginByPassword","loginByCode","jwtPayload","localStorage","getItem","decodeJwt","user","userId","userName","userRole","jwtVersion","exp"],"sources":["D:/PersonalFile/WebStudy/myShop-vue/myshop-vue/src/pages/Login/Login.vue"],"sourcesContent":["<template>\r\n  <h2>请登录</h2>\r\n</template>\r\n\r\n<script setup>\r\nimport useUser from '@/stores/useUser'\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport jwt_decode from \"jwt-decode\"\r\nimport useAuthenticationState from '@/hook/auth/useAuthenticationState';\r\n\r\nconst isPwdOrCode = ref(true);\r\nconst User = useUser();\r\nconst router = useRouter();\r\n\r\nconst loginModel = reactive({\r\n  phoneNumer: \"\",\r\n  password: \"\",\r\n  code: \"\"\r\n})\r\n\r\nonMounted(async () => {\r\n  const isAuth = ref(useAuthenticationState());\r\n  if (isAuth.value.state) {\r\n    router.push({\r\n      path: '/product/feature'\r\n    })\r\n  }\r\n})\r\n\r\nfunction ToCodeLogin() {\r\n  isPwdOrCode.value = !isPwdOrCode.value\r\n}\r\n\r\nasync function getCode(phone) {\r\n  await User.getCode(phone);\r\n}\r\n\r\nasync function login() {\r\n  const result = ref(false);\r\n\r\n  if (isPwdOrCode.value) {\r\n    result.value = await User.loginByPassword(loginModel.phoneNumer, loginModel.password);\r\n  } else {\r\n    result.value = await User.loginByCode(loginModel.phoneNumer, loginModel.code);\r\n  }\r\n\r\n  if (result.value === true) {\r\n    const jwtPayload = localStorage.getItem(\"authToken\");\r\n    const decodeJwt = jwt_decode(jwtPayload);\r\n\r\n    User.user.userId = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"];\r\n    User.user.userName = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"];\r\n    User.user.userRole = decodeJwt[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"];\r\n    User.user.jwtVersion = decodeJwt[\"JwtVersion\"];\r\n    User.user.exp = decodeJwt[\"exp\"];\r\n\r\n    router.push({\r\n      path: '/product/feature'\r\n    })\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped></style>"],"mappings":";AAKA,OAAOA,OAAO,MAAM,kBAAkB;AACtC,SAASC,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,sBAAsB,MAAM,oCAAoC;;;;;;;IAEvE,MAAMC,WAAW,GAAGN,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMO,IAAI,GAAGR,OAAO,CAAC,CAAC;IACtB,MAAMS,MAAM,GAAGL,SAAS,CAAC,CAAC;IAE1B,MAAMM,UAAU,GAAGR,QAAQ,CAAC;MAC1BS,UAAU,EAAE,EAAE;MACdC,QAAQ,EAAE,EAAE;MACZC,IAAI,EAAE;IACR,CAAC,CAAC;IAEFV,SAAS,CAAC,YAAY;MACpB,MAAMW,MAAM,GAAGb,GAAG,CAACK,sBAAsB,CAAC,CAAC,CAAC;MAC5C,IAAIQ,MAAM,CAACC,KAAK,CAACC,KAAK,EAAE;QACtBP,MAAM,CAACQ,IAAI,CAAC;UACVC,IAAI,EAAE;QACR,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IAEF,SAASC,WAAWA,CAAA,EAAG;MACrBZ,WAAW,CAACQ,KAAK,GAAG,CAACR,WAAW,CAACQ,KAAK;IACxC;IAEA,eAAeK,OAAOA,CAACC,KAAK,EAAE;MAC5B,MAAMb,IAAI,CAACY,OAAO,CAACC,KAAK,CAAC;IAC3B;IAEA,eAAeC,KAAKA,CAAA,EAAG;MACrB,MAAMC,MAAM,GAAGtB,GAAG,CAAC,KAAK,CAAC;MAEzB,IAAIM,WAAW,CAACQ,KAAK,EAAE;QACrBQ,MAAM,CAACR,KAAK,GAAG,MAAMP,IAAI,CAACgB,eAAe,CAACd,UAAU,CAACC,UAAU,EAAED,UAAU,CAACE,QAAQ,CAAC;MACvF,CAAC,MAAM;QACLW,MAAM,CAACR,KAAK,GAAG,MAAMP,IAAI,CAACiB,WAAW,CAACf,UAAU,CAACC,UAAU,EAAED,UAAU,CAACG,IAAI,CAAC;MAC/E;MAEA,IAAIU,MAAM,CAACR,KAAK,KAAK,IAAI,EAAE;QACzB,MAAMW,UAAU,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;QACpD,MAAMC,SAAS,GAAGxB,UAAU,CAACqB,UAAU,CAAC;QAExClB,IAAI,CAACsB,IAAI,CAACC,MAAM,GAAGF,SAAS,CAAC,sEAAsE,CAAC;QACpGrB,IAAI,CAACsB,IAAI,CAACE,QAAQ,GAAGH,SAAS,CAAC,4DAA4D,CAAC;QAC5FrB,IAAI,CAACsB,IAAI,CAACG,QAAQ,GAAGJ,SAAS,CAAC,8DAA8D,CAAC;QAC9FrB,IAAI,CAACsB,IAAI,CAACI,UAAU,GAAGL,SAAS,CAAC,YAAY,CAAC;QAC9CrB,IAAI,CAACsB,IAAI,CAACK,GAAG,GAAGN,SAAS,CAAC,KAAK,CAAC;QAEhCpB,MAAM,CAACQ,IAAI,CAAC;UACVC,IAAI,EAAE;QACR,CAAC,CAAC;MACJ;IACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}