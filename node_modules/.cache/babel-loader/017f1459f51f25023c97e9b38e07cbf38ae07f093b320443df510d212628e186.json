{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, toDisplayString as _toDisplayString, Fragment as _Fragment, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-2edc7104\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"请登录\", -1));\nconst _hoisted_2 = {\n  class: \"container\"\n};\nconst _hoisted_3 = {\n  class: \"phone-number\"\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"pwssword\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"code\"\n};\nimport useUser from '@/stores/useUser';\nimport { ref, reactive, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport jwt_decode from \"jwt-decode\";\nimport useAuthenticationState from '@/hook/auth/useAuthenticationState';\nimport useCart from '@/stores/useCart';\nexport default {\n  __name: 'Login',\n  setup(__props) {\n    const isPwdOrCode = ref(true);\n    const User = useUser();\n    const router = useRouter();\n    const Cart = useCart();\n    const loginModel = reactive({\n      phoneNumber: \"\",\n      password: \"\",\n      code: \"\"\n    });\n    onMounted(async () => {\n      const isAuth = ref(useAuthenticationState());\n      if (isAuth.value.state) {\n        router.push({\n          path: '/product/feature'\n        });\n      }\n    });\n    function ToCodeLogin() {\n      isPwdOrCode.value = !isPwdOrCode.value;\n    }\n    async function getCode(phone) {\n      await User.getCode(phone);\n    }\n    async function login() {\n      const result = ref(false);\n      if (isPwdOrCode.value) {\n        result.value = await User.loginByPassword(loginModel.phoneNumber, loginModel.password);\n      } else {\n        result.value = await User.loginByCode(loginModel.phoneNumber, loginModel.code);\n      }\n      if (result.value === true) {\n        const jwtPayload = localStorage.getItem(\"authToken\");\n        const decodeJwt = jwt_decode(jwtPayload);\n        User.user.userId = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"];\n        User.user.userName = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"];\n        User.user.userRole = decodeJwt[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"];\n        User.user.jwtVersion = decodeJwt[\"JwtVersion\"];\n        User.user.exp = decodeJwt[\"exp\"];\n        await Cart.storeCartItems(jwtPayload);\n        await Cart.GetCartsInDb();\n        router.push({\n          path: '/product/feature'\n        });\n      }\n    }\n    return (_ctx, _cache) => {\n      const _component_el_input = _resolveComponent(\"el-input\");\n      const _component_el_button = _resolveComponent(\"el-button\");\n      return _openBlock(), _createElementBlock(_Fragment, null, [_hoisted_1, _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_input, {\n        modelValue: loginModel.phoneNumber,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => loginModel.phoneNumber = $event),\n        placeholder: \"请输入手机号码\",\n        size: \"large\"\n      }, null, 8, [\"modelValue\"])]), isPwdOrCode.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createVNode(_component_el_input, {\n        modelValue: loginModel.password,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => loginModel.password = $event),\n        type: \"password\",\n        placeholder: \"请输入密码\",\n        size: \"large\",\n        \"show-password\": \"\"\n      }, null, 8, [\"modelValue\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_el_input, {\n        modelValue: loginModel.code,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => loginModel.code = $event),\n        placeholder: \"请输入验证码\",\n        size: \"large\",\n        style: {\n          \"width\": \"80%\"\n        }\n      }, null, 8, [\"modelValue\"]), _createVNode(_component_el_button, {\n        color: \"#626aef\",\n        size: \"large\",\n        style: {\n          \"margin-left\": \"15px\"\n        },\n        onClick: _cache[3] || (_cache[3] = $event => getCode(loginModel.phoneNumber))\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 获取验证码 \")]),\n        _: 1\n      })])), _createVNode(_component_el_button, {\n        color: \"#626aef\",\n        size: \"large\",\n        class: \"loginButton\",\n        onClick: login\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 登录 \")]),\n        _: 1\n      }), _createElementVNode(\"a\", {\n        onClick: ToCodeLogin\n      }, _toDisplayString(isPwdOrCode.value ? \"使用验证码登录\" : \"使用密码登录\"), 1)])], 64);\n    };\n  }\n};","map":{"version":3,"names":["useUser","ref","reactive","onMounted","useRouter","jwt_decode","useAuthenticationState","useCart","isPwdOrCode","User","router","Cart","loginModel","phoneNumber","password","code","isAuth","value","state","push","path","ToCodeLogin","getCode","phone","login","result","loginByPassword","loginByCode","jwtPayload","localStorage","getItem","decodeJwt","user","userId","userName","userRole","jwtVersion","exp","storeCartItems","GetCartsInDb"],"sources":["D:/PersonalFile/WebStudy/myShop-vue/myshop-vue/src/pages/Login/Login.vue"],"sourcesContent":["<template>\r\n  <h2>请登录</h2>\r\n\r\n  <div class=\"container\">\r\n    <div class=\"phone-number\">\r\n      <el-input v-model=\"loginModel.phoneNumber\" placeholder=\"请输入手机号码\" size=\"large\" />\r\n    </div>\r\n    <div class=\"pwssword\" v-if=\"isPwdOrCode\">\r\n      <el-input v-model=\"loginModel.password\" type=\"password\" placeholder=\"请输入密码\" size=\"large\" show-password />\r\n    </div>\r\n    <div class=\"code\" v-else>\r\n      <el-input v-model=\"loginModel.code\" placeholder=\"请输入验证码\" size=\"large\" style=\"width:80%\" />\r\n\r\n      <el-button color=\"#626aef\" size=\"large\" style=\"margin-left:15px;\" @click=\"getCode(loginModel.phoneNumber)\">\r\n        获取验证码\r\n      </el-button>\r\n    </div>\r\n\r\n    <el-button color=\"#626aef\" size=\"large\" class=\"loginButton\" @click=\"login\">\r\n      登录\r\n    </el-button>\r\n\r\n    <a @click=\"ToCodeLogin\">{{ isPwdOrCode ? \"使用验证码登录\" : \"使用密码登录\" }}</a>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport useUser from '@/stores/useUser'\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport jwt_decode from \"jwt-decode\"\r\nimport useAuthenticationState from '@/hook/auth/useAuthenticationState';\r\nimport useCart from '@/stores/useCart';\r\n\r\nconst isPwdOrCode = ref(true);\r\nconst User = useUser();\r\nconst router = useRouter();\r\nconst Cart = useCart();\r\n\r\nconst loginModel = reactive({\r\n  phoneNumber: \"\",\r\n  password: \"\",\r\n  code: \"\"\r\n})\r\n\r\nonMounted(async () => {\r\n  const isAuth = ref(useAuthenticationState());\r\n  if (isAuth.value.state) {\r\n    router.push({\r\n      path: '/product/feature'\r\n    })\r\n  }\r\n})\r\n\r\nfunction ToCodeLogin() {\r\n  isPwdOrCode.value = !isPwdOrCode.value\r\n}\r\n\r\nasync function getCode(phone) {\r\n  await User.getCode(phone);\r\n}\r\n\r\nasync function login() {\r\n  const result = ref(false);\r\n\r\n  if (isPwdOrCode.value) {\r\n    result.value = await User.loginByPassword(loginModel.phoneNumber, loginModel.password);\r\n  } else {\r\n    result.value = await User.loginByCode(loginModel.phoneNumber, loginModel.code);\r\n  }\r\n\r\n  if (result.value === true) {\r\n    const jwtPayload = localStorage.getItem(\"authToken\");\r\n    const decodeJwt = jwt_decode(jwtPayload);\r\n\r\n    User.user.userId = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"];\r\n    User.user.userName = decodeJwt[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"];\r\n    User.user.userRole = decodeJwt[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"];\r\n    User.user.jwtVersion = decodeJwt[\"JwtVersion\"];\r\n    User.user.exp = decodeJwt[\"exp\"];\r\n\r\n    await Cart.storeCartItems(jwtPayload);\r\n\r\n    await Cart.GetCartsInDb();\r\n\r\n    router.push({\r\n      path: '/product/feature'\r\n    })\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  width: 95%;\r\n}\r\n\r\n.container>div {\r\n  width: 50%;\r\n  margin: 15px;\r\n}\r\n\r\n.loginButton {\r\n  margin: 20px;\r\n}\r\n\r\na:hover {\r\n  color: purple;\r\n  text-decoration: underline;\r\n}\r\n</style>"],"mappings":";;;;;;;;;;;;;;;;;;AA2BA,OAAOA,OAAO,MAAM,kBAAkB;AACtC,SAASC,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,sBAAsB,MAAM,oCAAoC;AACvE,OAAOC,OAAO,MAAM,kBAAkB;;;;IAEtC,MAAMC,WAAW,GAAGP,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMQ,IAAI,GAAGT,OAAO,CAAC,CAAC;IACtB,MAAMU,MAAM,GAAGN,SAAS,CAAC,CAAC;IAC1B,MAAMO,IAAI,GAAGJ,OAAO,CAAC,CAAC;IAEtB,MAAMK,UAAU,GAAGV,QAAQ,CAAC;MAC1BW,WAAW,EAAE,EAAE;MACfC,QAAQ,EAAE,EAAE;MACZC,IAAI,EAAE;IACR,CAAC,CAAC;IAEFZ,SAAS,CAAC,YAAY;MACpB,MAAMa,MAAM,GAAGf,GAAG,CAACK,sBAAsB,CAAC,CAAC,CAAC;MAC5C,IAAIU,MAAM,CAACC,KAAK,CAACC,KAAK,EAAE;QACtBR,MAAM,CAACS,IAAI,CAAC;UACVC,IAAI,EAAE;QACR,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IAEF,SAASC,WAAWA,CAAA,EAAG;MACrBb,WAAW,CAACS,KAAK,GAAG,CAACT,WAAW,CAACS,KAAK;IACxC;IAEA,eAAeK,OAAOA,CAACC,KAAK,EAAE;MAC5B,MAAMd,IAAI,CAACa,OAAO,CAACC,KAAK,CAAC;IAC3B;IAEA,eAAeC,KAAKA,CAAA,EAAG;MACrB,MAAMC,MAAM,GAAGxB,GAAG,CAAC,KAAK,CAAC;MAEzB,IAAIO,WAAW,CAACS,KAAK,EAAE;QACrBQ,MAAM,CAACR,KAAK,GAAG,MAAMR,IAAI,CAACiB,eAAe,CAACd,UAAU,CAACC,WAAW,EAAED,UAAU,CAACE,QAAQ,CAAC;MACxF,CAAC,MAAM;QACLW,MAAM,CAACR,KAAK,GAAG,MAAMR,IAAI,CAACkB,WAAW,CAACf,UAAU,CAACC,WAAW,EAAED,UAAU,CAACG,IAAI,CAAC;MAChF;MAEA,IAAIU,MAAM,CAACR,KAAK,KAAK,IAAI,EAAE;QACzB,MAAMW,UAAU,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;QACpD,MAAMC,SAAS,GAAG1B,UAAU,CAACuB,UAAU,CAAC;QAExCnB,IAAI,CAACuB,IAAI,CAACC,MAAM,GAAGF,SAAS,CAAC,sEAAsE,CAAC;QACpGtB,IAAI,CAACuB,IAAI,CAACE,QAAQ,GAAGH,SAAS,CAAC,4DAA4D,CAAC;QAC5FtB,IAAI,CAACuB,IAAI,CAACG,QAAQ,GAAGJ,SAAS,CAAC,8DAA8D,CAAC;QAC9FtB,IAAI,CAACuB,IAAI,CAACI,UAAU,GAAGL,SAAS,CAAC,YAAY,CAAC;QAC9CtB,IAAI,CAACuB,IAAI,CAACK,GAAG,GAAGN,SAAS,CAAC,KAAK,CAAC;QAEhC,MAAMpB,IAAI,CAAC2B,cAAc,CAACV,UAAU,CAAC;QAErC,MAAMjB,IAAI,CAAC4B,YAAY,CAAC,CAAC;QAEzB7B,MAAM,CAACS,IAAI,CAAC;UACVC,IAAI,EAAE;QACR,CAAC,CAAC;MACJ;IACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}